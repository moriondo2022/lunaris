<html lang="en">

<head>
    <title>Exome Gene-level Group-File Server (Lunaris Version 3.5.3-RC2)</title>
    <!-- CSS -->
    <link rel="stylesheet" href="css/eggserver-new.css">
    <link rel="stylesheet" href="css/mdkp.css">
    <link rel="stylesheet" href="css/chunk-common.4e0fe4ce.css">
    <link rel="stylesheet" href="css/chunk-vendors.fb65572e.css">
    <link rel="stylesheet" href="codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="codemirror/theme/liquibyte.css">
    
    <!-- Scripts-->
    <script src="js/vep.js"></script>
    <script src="codemirror/lib/codemirror.js"></script>
    <script src="codemirror/mode/javascript/javascript.js"></script>
    <!-- Using Vue 2-->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
</head>

<body onload="init()" class="kp-default">
    <header>
        <img class="mdkp-logo" id="eggserverLogo" src="egg_server_logo.svg" alt="EGG Server logo"/>
        <h1>
            <!--Bolded initials to emphasize "EGG."-->
            <strong>E</strong>xome <strong>G</strong>ene-level <strong>G</strong>roup-file Server
        </h1>
        <div id="lunarisBranding">
            <div id="lunarisHeader"><span>Powered by</span> <span>Lunaris</span></div>
            <img id="lunarisLogo" src="lunaris_logo.svg" alt="Lunaris logo"/>
        </div>
    </header>
    
<div id="eggserver">
    <div class="container-fluid mdkp-body">
        <div class="card mdkp-card">
            <div class="row card-body">
                <div class="col-md-9">
                    <p>The <strong>Exome Gene-Level Group-File Generator</strong> is designed to, based on a user-provided location-sorted list of exome variants, annotate variants using the 
                        <a href="https://www.ensembl.org/info/docs/tools/vep/index.html" target="_blank" rel="noopener noreferrer"> Ensembl Variant Effect Predictor (VEP)</a> 
                        and generate group files to run gene-level association tests using rareMETALS or EPACTS format. Users can define masks based on annotations, or use one of the <a href="https://www.nature.com/articles/s41586-019-1231-2" target="_blank" rel="noopener noreferrer">published masks provided</a>.
                    </p>
                    <p> To download group files for UK BioBank 50k Exome release (2019), click
                        <a href="https://storage.googleapis.com/eggserver-data/examples/output/UKBBw1.ALL.variant.groupfiles.raremetals.tar" download="UKBBw1.ALL.variant.groupfiles.raremetals.tar">here</a> for rareMETALS and
                        <a href="https://storage.googleapis.com/eggserver-data/examples/output/UKBBw1.ALL.variant.groupfiles.epacts.tar" download="UKBBw1.ALL.variant.groupfiles.epacts.tar">here</a> for EPACTS format.
                    </p>
                </div>
                <!--div class="divider col"></div-->
                <div class="col-md-3" id="statuschecker">
                    <h3>Check status</h3>
                    <label for="sessioninput">Session ID</label>
                    <input type="text" id="sessioninput" name="sessioninput" size="8">
                    <button class="btn btn-primary" onclick="promptAndLoadSession()">Load</button>
                </div>
            </div>
        </div>
        <div class="card mdkp-card dataset-page-header">
            <div class="card-body">
                <h4 class="card-title">Create job</h4>
                <div role="tablist" class="accordion">
                    <div class="card mb-1">
                        <header role="tab" class="card-header p-1">
                            <button type="button" class="btn btn-outline-primary btn-block not-collapsed" aria-expanded="true" aria-controls="accordion-1">Source file 
                                <!--div class="criteria"></div-->
                            </button>
                        </header>
                        <div id="accordion-1" role="tabpanel" style class="collapse show">
                            <div class="card-body">
                                <div role="alert" aria-live="polite" aria-atomic="true" class="alert alert-info">
                                    Please upload a data file and select a reference genome to be used
                                </div>
                                <span>
                                    <div>
                                        <div class="filtering-ui-wrapper container-fluid">
                                            <div class="row filtering-ui-content">
                                                <div class="col filter-col-md" style="padding: 5px 7px;">
                                                    <div class="label">Upload a file</div>
                                                    <div data-v-06e3dc2f="">
                                                        <div data-v-06e3dc2f="" class="input-group"><!---->
                                                            <!--input data-v-06e3dc2f="" type="search" placeholder="Select a gene ..." aria-label="Select a gene ..." autocomplete="off" class="form-control "><!---->
                                                            <input class="form-control" type="file" id="inputfile" name="myfile">
                                                        </div>
                                                        <div data-v-06e3dc2f="" class="list-group shadow vbt-autcomplete-list" style="width: 220px; display: none;">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col filter-col-md" style="padding: 5px 7px;">
                                                    <div class="label">Reference Genome</div>
                                                    <div data-v-06e3dc2f="">
                                                        <div data-v-06e3dc2f="" class="input-group">
                                                            <select class="form-control" name="hg" id="hg" placeholder="Choose Genome">
                                                                <option>hg19</option>
                                                                <option>hg38</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </span>
                                <strong>Requirements</strong>
                                <ul>
                                    <li>File must be formatted in VCF format</li>
                                    <li>Data must be sorted by location</li>
                                    <li>At least first five columns of what(?)</li>
                                    <li>Download example input file: <a href="predictor/sample_input.vcf" download="sample_input.vcf">sample_input.vcf</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-1"></div>
                    <div class="card mb-1"></div>
        <div class="paneltab">
            <div class="tabtop">
                <h3 class="tabheading"><a>Mask</a></h3>
                <span class="source-info">
                    <span id="output-format">output format</span>
                </span>
            </div>
            <ul>
                <li>Enclose field names in backticks.</li>
                <li>Backticks may be omitted if field name contains no whitespace; starts with letter or underscore; and contains only letters, digits and underscores.</li>
                <li>Enclose string values in double-quotes.</li>
                <li>Using field tests written as name-operator-value (e.g. REF == "A"), build Boolean expressions using AND, OR and parentheses.</li>
            </ul>
            <p>You can:</p>
            <ol>
                <li>Use a pre-defined mask.</li>
                <li>Start with a pre-defined mask as a template and edit it.</li>
                <li>Start building from scratch by typing in the editor.</li>
            </ol>
            <!-- This ought to be done with Vue. toggle seen -->
            <div id="mask-subtabs">
                <div id="mask-tabtop">
                    <label><button id="load-mask" onclick="setPredefinedMask()">Load predefined mask</button></label>
                    <label><button id="fields-operators">Fields & operators</button></label>
                </div>
                <div id=mask-main>
                    <label for="masks">Mask</label>
                    <select name="masks" id="masks">
                        <option value="0of5_1pct">0of5_1pct</option>
                    </select>
                </div>
            </div>
            <div id="clear-mask">
                    <label><button onclick="resetFilters()">Clear Mask</button></label>
            </div>
            <p id="code_mirror_parent"></p>
        </div>
    
                </div>
                </div>

   
        </div>
    </div>
</div>
<p>

    <label>Available fields:<select name="fields" id="fields"></select></label>.
    <label>Available operators:
    <select name="operators" id="operators">
        <option>== (equals)</option>
        <option>!= (does not equal)</option>
        <option>~ (contains regex)</option>
        <option>!~ (does not contain regex)</option>
        <option>~= (matches regex)</option>
        <option>!~= (does not match regex)</option>
        <option>&lt; (less than)</option>
        <option>&le; (less or equal)</option>
        <option>&gt; (greater than)</option>
        <option>&ge; (greater or equal)</option>
    </select></label>
    Check out predefined masks as examples.
</p>


<p>
    <span class="stepNumber">3.</span>
    <label>Select an output format
    <select name="formats" id="formats">
        <option value="rareMETALS">list/rareMETALS</option>
        <option value="EPACTS">EPACTS</option>
    </select></label>
    and submit variant list to server
    <button onclick="submit()">Submit</button> and wait for results to be calculated. Check for status updates below.
</p>

<p id="status_area"></p>

<p>Session id is <b><span id="session_id_area"></span></b>.
    <button onclick="promptAndLoadSession()">Load different session</button>
</p>

<p id="submission_area">
    <span id="statusUpdatesPlaceholder">(Submission status updates will appear here)</span>
</p>

<hr>
<p>
    Powered by Lunaris Version 3.5.3-RC2. Copyright 2020-21 Broad Institute
</p>

</body>

</html>